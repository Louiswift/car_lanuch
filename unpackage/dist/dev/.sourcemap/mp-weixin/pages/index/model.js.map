{"version":3,"sources":[null,"webpack:///D:/CarMay/launcher_car/pages/index/model.vue?65e6","webpack:///D:/CarMay/launcher_car/pages/index/model.vue?e749","webpack:///D:/CarMay/launcher_car/pages/index/model.vue?4946","uni-app:///pages/index/model.vue"],"names":["data","right2","right1","left1","left2","mounted","methods","init","container","renderer","camera","controls","scene","clock","rgbeLoader","r","loader","models","vm","console","onMouseMove","mouse","event","raycaster","openOrCloseDoor","activeAction","previousAction","actions","reset","play","createGUI","mixer","action","myrender","requestAnimationFrame"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;;;AAGpD;AACmK;AACnK,gBAAgB,6KAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAkmB,CAAgB,+mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACUtnB;AAEA;AAIA;AAIA;AAEA;AAAA;;;;;;;;;;;AAEA;AAAA,eACA;EACAA;IACA;MACA;MACAC;MACAC;MACAC;MACAC;MACA;IACA;EACA;EACAC;IACA;EACA;EACAC;IACAC;MACA;MACAC;MACA;MACAC;;MAEA;MACAC;MACA;MACAA;;MAEA;MACAC;MACA;MACAA;MACA;MACAA;MACA;MACAA;MACAA;;MAEA;MACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;;MAEA;MACAL;MACA;MACA;MACAM;QACAC;QACAH;QACAA;MACA;MAEA;MACA;MACA;MACAI;QACA;QACA;QACAC;QACAL;QACA;QACA;QACAM;MACA;;MAEA;MACAT;MACA;MACAA;MACAU;MACA;MACAX;MACA;IACA;IACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACAY;MACA;MACAC;MACAC;MACA;MACA;AACA;AACA;AACA;AACA;MACA;MACA;MACA;MACA;MAEA;MACA;MACA;MACA;;MAEA;MACA;MAEA;;MAEA;MACA;MACAC;MACA;MACAJ;MACA;QACAA;QACA;AACA;AACA;;QAEA;UACAA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;QACA;QAEA;UACAA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;QACA;QAEA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;QACA;QAEA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;QACA;MACA;IAEA;IACA;IACAK;MACA;MACA;MACAC;MACA;QACA;UACAC;UACAA;QACA;MACA;MACAC;MACAA,cACAC,QACAC;IACA;IACA;IACAC;MACAC;MACAJ;MACA;QAEA;QACA;QACAK;QACAA;QACAL;MACA;IACA;IAEAM;MACAxB;MACA;MACA;MACAyB;IACA;EACA;AACA;AAAA,2B","file":"pages/index/model.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./model.vue?vue&type=template&id=e694647a&\"\nvar renderjs\nimport script from \"./model.vue?vue&type=script&lang=js&\"\nexport * from \"./model.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/model.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./model.vue?vue&type=template&id=e694647a&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./model.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./model.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view id=\"container\" style=\"width: 100%;height: 400rpx;\">\r\n\r\n\t\t</view>\r\n\t</view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport * as THREE from 'three'\r\n\r\n\timport {\r\n\t\tOrbitControls\r\n\t} from 'three/examples/jsm/controls/OrbitControls.js';\r\n\r\n\timport {\r\n\t\tRGBELoader\r\n\t} from 'three/examples/jsm/loaders/RGBELoader.js';\r\n\r\n\timport {\r\n\t\tGLTFLoader\r\n\t} from 'three/examples/jsm/loaders/GLTFLoader.js';\r\n\r\n\tlet container, renderer, camera, scene, controls, mixer, clock, mouse, actions;\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t//openDoor: null,\r\n\t\t\t\tright2: false,\r\n\t\t\t\tright1: false,\r\n\t\t\t\tleft1:false,\r\n\t\t\t\tleft2:false,\r\n\t\t\t\t// container:null\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.init()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinit() {\r\n\t\t\t\t//获取dom节点\r\n\t\t\t\tcontainer = document.getElementById(\"container\")\r\n\t\t\t\t//创建渲染器WebGLRenderer\r\n\t\t\t\trenderer = new THREE.WebGLRenderer();\r\n\r\n\t\t\t\t//创建摄像机\r\n\t\t\t\tcamera = new THREE.PerspectiveCamera(55, container.clientWidth / container.clientHeight, 0.1, 100);\r\n\t\t\t\t//设置摄像机在舞台的位置（3D世界）\r\n\t\t\t\tcamera.position.set(1, 5.5, 13);\r\n\r\n\t\t\t\t//创建控制器\r\n\t\t\t\tcontrols = new OrbitControls(camera, container);\r\n\t\t\t\t// 启用阻尼效果，让摄像机的移动更加平滑自然\r\n\t\t\t\tcontrols.enableDamping = true\r\n\t\t\t\t// 设置摄像机的最大距离，限制用户能够远离场景的最大距离\r\n\t\t\t\tcontrols.maxDistance = 5;\r\n\t\t\t\t// 设置摄像机的最小缩放值，防止用户将场景放大得太小\r\n\t\t\t\tcontrols.minZoom = 1.5;\r\n\t\t\t\tcontrols.update()\r\n\r\n\t\t\t\t//创建舞台（3D世界）\r\n\t\t\t\tscene = new THREE.Scene();\r\n\t\t\t\t// 创建网格辅助工具\r\n\t\t\t\t// const gridHelper = new THREE.GridHelper(100, 100);\r\n\t\t\t\t// scene.add(gridHelper);\r\n\t\t\t\t// // 创建坐标轴辅助工具\r\n\t\t\t\t// const axesHelper = new THREE.AxesHelper(5);\r\n\t\t\t\t// scene.add(axesHelper);\r\n\t\t\t\t//创建时钟 用于控制画面渲染帧数\r\n\t\t\t\tclock = new THREE.Clock();\r\n\r\n\t\t\t\t//监听鼠标移动事件\r\n\t\t\t\tcontainer.addEventListener('mousemove', this.onMouseMove);\r\n\t\t\t\t//创建照明\r\n\t\t\t\tconst rgbeLoader = new RGBELoader()\r\n\t\t\t\trgbeLoader.load(\"./static/zwartkops_curve_sunset_1k.hdr\", function(r) {\r\n\t\t\t\t\tr.mapping = THREE.EquirectangularReflectionMapping;\r\n\t\t\t\t\tscene.background = r; \r\n\t\t\t\t\tscene.environment = r;\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlet vm = this\r\n\t\t\t\t//加载模型\r\n\t\t\t\tconst loader = new GLTFLoader();\r\n\t\t\t\tloader.load(\"./static/car2.glb\", function(gltf) {\r\n\t\t\t\t\tlet position = new THREE.Vector2()\r\n\t\t\t\t\tconst models = gltf.scene\r\n\t\t\t\t\tmodels.position.set(-2, 0, 0)\r\n\t\t\t\t\tscene.add(models)\r\n\t\t\t\t\t//动画片段\r\n\t\t\t\t\t//vm.open(gltf) //这里不能使用this\r\n\t\t\t\t\tvm.createGUI(gltf.scene, gltf.animations);\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// 设置渲染器的像素比，以适应设备的像素密度\r\n\t\t\t\trenderer.setPixelRatio(window.devicePixelRatio);\r\n\t\t\t\t// 根据容器的大小设置渲染器的大小，确保渲染区域填充整个容器 \r\n\t\t\t\trenderer.setSize(container.clientWidth, container.clientHeight);\r\n\t\t\t\tconsole.log(renderer)\r\n\t\t\t\t//渲染\r\n\t\t\t\tcontainer.appendChild(renderer.domElement);\r\n\t\t\t\tthis.myrender()\r\n\t\t\t},\r\n\t\t\t/*open(gltf) {\r\n\t\t\t\tmixer = new THREE.AnimationMixer(gltf.scene);\r\n\t\t\t\t//其中的一个动画片段\r\n\t\t\t\tconst clip = gltf.animations[1];\r\n\t\t\t\tconst action = mixer.clipAction(clip);\r\n\t\t\t\t//是否停留在最后一帧\r\n\t\t\t\taction.clampWhenFinished = true;\r\n\t\t\t\t//只需要播放一次\r\n\t\t\t\taction.loop = THREE.LoopOnce;\r\n\t\t\t\tthis.openDoor = action\r\n\t\t\t},*/\r\n\t\t\tonMouseMove() {\r\n\t\t\t\t//初始化鼠标向量 加法、减法、标量乘法、点积、叉积等\r\n\t\t\t\tmouse = new THREE.Vector2(1, 1);\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\t//WEBGL转openGL坐标\r\n\t\t\t\t/**\r\n\t\t\t\t * OpenGL坐标系的范围是[-1, 1]，因此需要对相对坐标进行归一化和翻转操作。x坐标乘以2并减去1，\r\n\t\t\t\t * 使得范围从[0, 1]变为[-1, 1]；y坐标需要进行翻转，\r\n\t\t\t\t * 乘以-1并加上1，使得范围从[0, 1]变为[-1, 1]。\r\n\t\t\t\t */\r\n\t\t\t\t// 获取渲染器视口的左上角x坐标\r\n\t\t\t\tlet px = renderer.domElement.getBoundingClientRect().left\r\n\t\t\t\t// 获取渲染器视口的左上角y坐标\r\n\t\t\t\tlet py = renderer.domElement.getBoundingClientRect().top\r\n\r\n\t\t\t\tlet x = ((event.clientX - px) / container.clientWidth) * 2 - 1\r\n\t\t\t\tlet y = -((event.clientY - py) / container.clientHeight) * 2 + 1\r\n\t\t\t\t//初始化一个openGL的三维向量\r\n\t\t\t\tlet vector = new THREE.Vector3(x, y)\r\n\r\n\t\t\t\t//通过unproject(camera)方法将vector反投影 初始化世界坐标\r\n\t\t\t\tlet wordVector = vector.unproject(camera)\r\n\r\n\t\t\t\tlet ray = wordVector.sub(camera.position).normalize()\r\n\r\n\t\t\t\t//camera.position 相机地址 ray射线\r\n\t\t\t\tconst raycaster = new THREE.Raycaster(camera.position, ray);\r\n\t\t\t\traycaster.camera = camera\r\n\t\t\t\tconst intersection = raycaster.intersectObjects(scene.children, true);\r\n\t\t\t\tconsole.log(\"===\" + intersection.length)\r\n\t\t\t\tif (intersection.length > 0) {\r\n\t\t\t\t\tconsole.log(intersection[0].object.parent.name)\r\n\t\t\t\t\t/*if (intersection[0].object.parent.name === 'right2') {\r\n\t\t\t\t\t\tthis.openDoor.play()\r\n\t\t\t\t\t}*/\r\n\r\n\t\t\t\t\tif (intersection[0].object.parent.name === 'right2') {\r\n\t\t\t\t\t\tconsole.log(\"你操作right2\")\r\n\t\t\t\t\t\tif (this.right2) {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openRight2\", -1)\r\n\t\t\t\t\t\t\tthis.right2 = false\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openRight2\", 1)\r\n\t\t\t\t\t\t\tthis.right2 = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (intersection[0].object.parent.name === 'right1') {\r\n\t\t\t\t\t\tconsole.log(\"你操作right1\")\r\n\t\t\t\t\t\tif (this.right1) {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openRight1\", -1)\r\n\t\t\t\t\t\t\tthis.right1 = false\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openRight1\", 1)\r\n\t\t\t\t\t\t\tthis.right1 = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (intersection[0].object.parent.name === 'left1') {\r\n\t\t\t\t\t\tif (this.left1) {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openLeft1\", -1)\r\n\t\t\t\t\t\t\tthis.left1 = false\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openLeft1\", 1)\r\n\t\t\t\t\t\t\tthis.left1 = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (intersection[0].object.parent.name === 'left2') {\r\n\t\t\t\t\t\tif (this.left2) {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openLeft2\", -1)\r\n\t\t\t\t\t\t\tthis.left2 = false\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.openOrCloseDoor(\"openLeft2\", 1)\r\n\t\t\t\t\t\t\tthis.left2 = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\t//开关门\r\n\t\t\topenOrCloseDoor(data, timeScale) {\r\n\t\t\t\tlet activeAction = \"\"\r\n\t\t\t\tlet previousAction = activeAction;\r\n\t\t\t\tactiveAction = actions[data];\r\n\t\t\t\tif (previousAction) {\r\n\t\t\t\t\tif (previousAction !== activeAction) {\r\n\t\t\t\t\t\tpreviousAction.setEffectiveWeight(0)\r\n\t\t\t\t\t\tpreviousAction.setEffectiveWeight(1)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tactions[data].timeScale = timeScale\r\n\t\t\t\tactions[data]\r\n\t\t\t\t\t.reset()\r\n\t\t\t\t\t.play();\r\n\t\t\t},\r\n\t\t\t//动画\r\n\t\t\tcreateGUI(model, animations) {\r\n\t\t\t\tmixer = new THREE.AnimationMixer(model);\r\n\t\t\t\tactions = {};\r\n\t\t\t\tfor (let i = 0; i < animations.length; i++) {\r\n\r\n\t\t\t\t\tconst clip = animations[i];\r\n\t\t\t\t\tconst action = mixer.clipAction(clip);\r\n\t\t\t\t\taction.clampWhenFinished = true;\r\n\t\t\t\t\taction.loop = THREE.LoopOnce;\r\n\t\t\t\t\tactions[clip.name] = action\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmyrender() {\r\n\t\t\t\trenderer.render(scene, camera);\r\n\t\t\t\tconst dt = clock.getDelta();\r\n\t\t\t\tif (mixer) mixer.update(dt);\r\n\t\t\t\trequestAnimationFrame(this.myrender);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n</style>"],"sourceRoot":""}